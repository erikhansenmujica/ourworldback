import { Model } from 'mongoose';
import { Injectable, Inject, Logger } from '@nestjs/common';
import { ISelection } from './interfaces/selection.interface';
import { SELECTION_MODEL, TILE_MODEL } from './constants';
import { CreateSelectionDto } from './dto/create-selection.dto';
@Injectable()
export class SelectionsService {
  constructor(
    @Inject(SELECTION_MODEL)
    private selectionModel: Model<ISelection>,
  ) {}
  async create(createSelection: CreateSelectionDto): Promise<ISelection> {
    this.selectionModel.createIndexes({ geometry: '2dsphere' });
    const createdSelection = new this.selectionModel(createSelection);
    return createdSelection.save();
  }

  async getByBoundaries(point: Number[]): Promise<any[]> {
    return await this.selectionModel.find({
      geometry: {
        $geoWithin: { $centerSphere: [point, 10 / 3963.2] },
      },
    });
  }
}

// db.boundaries.createIndex({ geometry: '2dsphere' });

// db.boundaries.insertMany([
//   {
//     name: 'Central Park',
//     geometry: {
//       type: 'Polygon',
//       coordinates: [
//         [
//           [-73.96802384946837, 40.7799380605096],
//           [-73.96806402004573, 40.77984702289174],
//           [-73.96797390992424, 40.779777476464275],
//           [-73.9678436292739, 40.77979896742501],
//           [-73.96775351958668, 40.77972942087558],
//           [-73.9676232389913, 40.779750911576166],
//           [-73.96758306765528, 40.77984194891767],
//           [-73.96745278668698, 40.77986343944959],
//           [-73.96736267748258, 40.779793892548504],
//           [-73.96723239656926, 40.779815382820274],
//           [-73.96719222443244, 40.779906420084636],
//           [-73.9670619431462, 40.779927910187745],
//           [-73.96697183442465, 40.779858362935],
//           [-73.96684155319338, 40.77987985277795],
//           [-73.96680138025577, 40.77997088996515],
//           [-73.96667109865159, 40.779992379639445],
//           [-73.96658099041291, 40.77992283203505],
//           [-73.96645070886369, 40.779944321449186],
//           [-73.96636060105929, 40.77987477372282],
//           [-73.96623031956507, 40.7798962628768],
//           [-73.96619014544736, 40.77998729984863],
//           [-73.96605986358021, 40.78000878883396],
//           [-73.9659697562587, 40.779939240755944],
//           [-73.96583947444654, 40.779960729481104],
//           [-73.96579929952806, 40.78005176637578],
//           [-73.96566901734302, 40.78007325493227],
//           [-73.96557891050436, 40.7800037065026],
//           [-73.96544862837432, 40.780025194798945],
//           [-73.96540845265503, 40.78011623161642],
//           [-73.96527817015209, 40.780137719744076],
//           [-73.96518806379635, 40.78006817096278],
//           [-73.9650577813484, 40.78008965883028],
//           [-73.96501760482833, 40.78018069557059],
//           [-73.9651077111355, 40.780250244581566],
//           [-73.96506753457325, 40.78034128152105],
//           [-73.9649372513245, 40.78036276931138],
//           [-73.96489707434075, 40.780453806311876],
//           [-73.96476679071914, 40.78047529393351],
//           [-73.9647266133139, 40.78056633099501],
//           [-73.96481671990959, 40.78063588057308],
//           [-73.96477654246219, 40.78072691783379],
//           [-73.96464625803975, 40.78074840537823],
//           [-73.96460608017082, 40.78083944269993],
//           [-73.96469618710367, 40.7809089926154],
//           [-73.96465600919255, 40.78100003013631],
//           [-73.96474611651112, 40.7810695801595],
//           [-73.96470593855783, 40.78116061787962],
//           [-73.96457565290667, 40.781182105438326],
//           [-73.96453547453187, 40.78127314321942],
//           [-73.96440518850781, 40.78129463060945],
//           [-73.96436500971153, 40.781385668451556],
//           [-73.96445511731861, 40.78145521904182],
//           [-73.9644149384801, 40.78154625708313],
//           [-73.96450504647291, 40.78161580778113],
//           [-73.96446486759224, 40.78170684602162],
//           [-73.96455497597078, 40.78177639682735],
//           [-73.96451479704791, 40.78186743526704],
//           [-73.96438450936716, 40.781888922762796],
//           [-73.96434433002277, 40.78197996126346],
//           [-73.96421404196911, 40.782001448590535],
//           [-73.96417386220318, 40.7820924871522],
//           [-73.96426397087028, 40.78216203852501],
//           [-73.96422379106217, 40.78225307728588],
//           [-73.964313900115, 40.782322628766394],
//           [-73.96427372026469, 40.78241366772646],
//           [-73.96436382970327, 40.78248321931469],
//           [-73.96432364981077, 40.78257425847395],
//           [-73.96441375963511, 40.7826438101699],
//           [-73.96454404940052, 40.78262232247692],
//           [-73.96463415965921, 40.78269187405091],
//           [-73.96476444947967, 40.782670386097756],
//           [-73.96485456017271, 40.78273993754975],
//           [-73.96498485004818, 40.78271844933641],
//           [-73.96507496117559, 40.7827880006664],
//           [-73.96503478237892, 40.7828790404395],
//           [-73.9651248938921, 40.7829485918772],
//           [-73.96525518425052, 40.7829271033122],
//           [-73.96534529619804, 40.78299665462792],
//           [-73.96547558661148, 40.78297516580273],
//           [-73.96556569899337, 40.78304471699647],
//           [-73.9656959894618, 40.78302322791108],
//           [-73.9657361671204, 40.782932187723404],
//           [-73.9658664572159, 40.78291069846931],
//           [-73.96595657008073, 40.78298024931138],
//           [-73.96608686023121, 40.78295875979708],
//           [-73.96617697353041, 40.78302831051716],
//           [-73.9663072637359, 40.78300682074268],
//           [-73.96634744021424, 40.782915780339614],
//           [-73.96647773004676, 40.78289429039642],
//           [-73.9665678438289, 40.78296384076483],
//           [-73.9666981337164, 40.782942350561456],
//           [-73.96678824793287, 40.78301190080785],
//           [-73.96691853787539, 40.78299041034428],
//           [-73.9670086525262, 40.783059960468684],
//           [-73.96713894252368, 40.78303846974494],
//           [-73.96717911744238, 40.78294742898828],
//           [-73.96730940706689, 40.78292593809585],
//           [-73.96734958156408, 40.782834897400186],
//           [-73.96747987081564, 40.78281340633906],
//           [-73.96756998599793, 40.78288295588207],
//           [-73.96770027530444, 40.782861464560746],
//           [-73.96774044900073, 40.78277042378794],
//           [-73.96787073793428, 40.782748932297906],
//           [-73.96791091120906, 40.78265789158611],
//           [-73.96804119976964, 40.78263639992741],
//           [-73.96808137262289, 40.78254535927662],
//           [-73.96821166081052, 40.782523867449264],
//           [-73.96825183324228, 40.78243282685947],
//           [-73.96838212105692, 40.782411334863426],
//           [-73.96842229306715, 40.78232029433465],
//           [-73.96855258050883, 40.78229880216993],
//           [-73.96859275209756, 40.782207761702196],
//           [-73.96850263662398, 40.782138213537344],
//           [-73.96854280817057, 40.782047173268786],
//           [-73.96867309481138, 40.78202568102692],
//           [-73.96871326593647, 40.7819346408194],
//           [-73.96884355220432, 40.78191314840885],
//           [-73.96888372290789, 40.781822108262354],
//           [-73.96879360772303, 40.78175256066455],
//           [-73.96883377838448, 40.78166152071725],
//           [-73.96896406385146, 40.781640028229575],
//           [-73.96900423409143, 40.7815489883433],
//           [-73.96891411924379, 40.78147944108288],
//           [-73.96895428944164, 40.78138840139581],
//           [-73.96886417497979, 40.78131885424309],
//           [-73.9689043451355, 40.781227814755226],
//           [-73.96903462937372, 40.7812063222819],
//           [-73.96907479910796, 40.78111528285507],
//           [-73.96898468498331, 40.78104573603972],
//           [-73.96885440117299, 40.78106722842151],
//           [-73.96876428748264, 40.780997681484166],
//           [-73.96880445755411, 40.780906642394704],
//           [-73.96893474093656, 40.780885150104424],
//           [-73.96897491058655, 40.780794111076],
//           [-73.96888479723346, 40.780724564476024],
//           [-73.96875451427888, 40.7807460566748],
//           [-73.96866440136007, 40.78067650995283],
//           [-73.96870457134727, 40.78058547126178],
//           [-73.96861445881422, 40.7805159246475],
//           [-73.96848417634249, 40.78053741649461],
//           [-73.96839406424372, 40.78046786975833],
//           [-73.96843423456815, 40.78037683140467],
//           [-73.96834412285513, 40.780307284776114],
//           [-73.96838429313743, 40.78021624662164],
//           [-73.96829418181015, 40.78014670010079],
//           [-73.96833435205032, 40.78005566214552],
//           [-73.96824424110878, 40.779986115732356],
//           [-73.96811395997564, 40.780007607044745],
//           [-73.96802384946837, 40.7799380605096],
//         ],
//       ],
//     },
//     category: 'Parks',
//   },
// ]);

// db.boundaries.findOne({
//   geometry: {
//     $geoIntersects: {
//       $geometry: {
//         type: 'Point',
//         coordinates: [-73.96646674941243, 40.78114771376393],
//       },
//     },
//   },
// });
